<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>反应时间测试</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: background 0.1s;
    }

    .container {
      text-align: center;
      padding: 2rem;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 2rem;
      font-weight: 300;
    }

    #game-area {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: #16213e;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      margin: 0 auto 2rem;
    }

    #game-area:hover {
      transform: scale(1.02);
    }

    #game-area.waiting {
      background: #4a1a1a;
    }

    #game-area.ready {
      background: #1a4a2e;
    }

    #game-area.clicked {
      background: #4a3a1a;
    }

    .instruction {
      font-size: 1.1rem;
      color: #888;
      margin-bottom: 1rem;
      min-height: 1.5rem;
    }

    .result {
      font-size: 3rem;
      font-weight: bold;
      color: #4ecdc4;
      margin-bottom: 0.5rem;
      min-height: 3.5rem;
    }

    .stats {
      display: flex;
      gap: 2rem;
      justify-content: center;
      margin-top: 2rem;
      color: #888;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      color: #fff;
      font-weight: bold;
    }

    .stat-label {
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }

    .reset-btn {
      margin-top: 1.5rem;
      padding: 0.75rem 2rem;
      font-size: 1rem;
      background: transparent;
      border: 2px solid #4ecdc4;
      color: #4ecdc4;
      border-radius: 2rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .reset-btn:hover {
      background: #4ecdc4;
      color: #1a1a2e;
    }

    .history {
      margin-top: 2rem;
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      flex-wrap: wrap;
      max-width: 400px;
    }

    .history-item {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #333;
    }

    .history-item.fast { background: #4ecdc4; }
    .history-item.slow { background: #ff6b6b; }
  </style>
</head>
<body>
  <div class="container">
    <h1>反应时间测试</h1>

    <div class="instruction" id="instruction">点击圆圈开始测试</div>
    <div class="result" id="result">-</div>

    <div id="game-area">开始</div>

    <div class="stats">
      <div class="stat-item">
        <div class="stat-value" id="best">-</div>
        <div class="stat-label">最佳 (ms)</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="avg">-</div>
        <div class="stat-label">平均 (ms)</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="count">0</div>
        <div class="stat-label">测试次数</div>
      </div>
    </div>

    <div class="history" id="history"></div>

    <button class="reset-btn" id="reset">重置数据</button>
  </div>

  <script>
    const gameArea = document.getElementById('game-area');
    const instruction = document.getElementById('instruction');
    const result = document.getElementById('result');
    const bestEl = document.getElementById('best');
    const avgEl = document.getElementById('avg');
    const countEl = document.getElementById('count');
    const historyEl = document.getElementById('history');
    const resetBtn = document.getElementById('reset');

    let state = 'idle'; // idle, waiting, ready
    let startTime = 0;
    let timeoutId = null;
    let results = [];

    // 状态类名映射
    const stateClasses = {
      idle: '',
      waiting: 'waiting',
      ready: 'ready',
      clicked: 'clicked'
    };

    gameArea.addEventListener('click', handleClick);
    resetBtn.addEventListener('click', resetData);

    function handleClick() {
      switch (state) {
        case 'idle':
          startGame();
          break;
        case 'waiting':
          // 提前点击，失败
          failGame('太急了，等绿色出现再点！');
          break;
        case 'ready':
          // 正常点击
          endGame();
          break;
      }
    }

    function startGame() {
      state = 'waiting';
      gameArea.className = 'waiting';
      gameArea.textContent = '等待...';
      instruction.textContent = '看到绿色就点击！';

      const delay = 1500 + Math.random() * 2500; // 1.5-4秒

      timeoutId = setTimeout(() => {
        state = 'ready';
        gameArea.className = 'ready';
        gameArea.textContent = '点击！';
        instruction.textContent = '快！';
        startTime = performance.now();
      }, delay);
    }

    function endGame() {
      const reactionTime = Math.round(performance.now() - startTime);
      state = 'idle';
      gameArea.className = '';
      gameArea.textContent = '再来一次';

      results.push(reactionTime);
      updateStats();
      updateHistory(reactionTime);

      result.textContent = reactionTime + ' ms';
      instruction.textContent = reactionTime < 200 ? '超快！' : reactionTime < 300 ? '不错！' : '再来一次？';
    }

    function failGame(msg) {
      clearTimeout(timeoutId);
      state = 'idle';
      gameArea.className = 'clicked';
      gameArea.textContent = '再来';
      result.textContent = '失败';
      instruction.textContent = msg;

      setTimeout(() => {
        gameArea.className = '';
      }, 500);
    }

    function updateStats() {
      if (results.length === 0) return;

      const best = Math.min(...results);
      const avg = Math.round(results.reduce((a, b) => a + b, 0) / results.length);

      bestEl.textContent = best;
      avgEl.textContent = avg;
      countEl.textContent = results.length;
    }

    function updateHistory(time) {
      const dot = document.createElement('div');
      dot.className = 'history-item' + (time < 250 ? ' fast' : time > 400 ? ' slow' : '');
      dot.title = time + ' ms';
      historyEl.appendChild(dot);

      // 只保留最近20个
      while (historyEl.children.length > 20) {
        historyEl.removeChild(historyEl.firstChild);
      }
    }

    function resetData() {
      results = [];
      bestEl.textContent = '-';
      avgEl.textContent = '-';
      countEl.textContent = '0';
      historyEl.innerHTML = '';
      result.textContent = '-';
      instruction.textContent = '点击圆圈开始测试';
      state = 'idle';
      gameArea.className = '';
      gameArea.textContent = '开始';
    }
  </script>
</body>
</html>
